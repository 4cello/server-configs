version: "3.9"

networks:
  traefik:
    external: true
  mqtt:
    name: mqtt

services:
  mqtt:
    container_name: mqtt
    image: eclipse-mosquitto
    restart: unless-stopped
    networks:
      - traefik
      - mqtt
    ports:
      - 1883:1883
      - 9001:9001
    volumes:
      - ./config:/mosquitto/config
      - ./data:/mosquito/data
      - ./log:/mosquitto/log
    labels:
      traefik.enable: false
      traefik.tcp.services.mqtt.loadbalancer.server.port: 1883
      traefik.tcp.services.mqtt_websocket.loadbalancer.server.port: 9001
      traefik.tcp.routers.tcpr_mqtt.entrypoints: mqtt
      traefik.tcp.routers.tcpr_mqtt.rule: HostSNI(`mqtt.circacerulean.net`)
      traefik.tcp.routers.tcpr_mqtt.service: mqtt
      traefik.tcp.routers.tcpr_mqtt_websocket.entrypoints: websocket
      traefik.tcp.routers.tcpr_mqtt_websocket.rule: HostSNI(`mqtt.circacerulean.net`)
      traefik.tcp.routers.tcpr_mqtt_websocket.service: mqtt_websocket
